{
    "contents" : "<html>\n\n<head>\n<title>Divvy Challenge Notes</title>\n</head>\n\n<body>\n\n<p>Code and notes for visualizing Divvy data <a href='http://divvybikes.com/datachallenge'> at this website</a></p>\n\n<p>Need some basic functions to ease data input</p>\n<!--begin.rcode label=\"Functions for support\"\nlibrary(ggplot2)\nlibrary(plyr)\nlibrary(RColorBrewer)\nmakeLatLong <- function(dir,fi){\n  require(rgdal)\n  require(sp)\n  layer <- readOGR(dir, layer=fi)\n  layer <- spTransform(layer,CRS(\"+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0\"))\n  return(layer)\n}\nend.rcode-->\n\n\n<p>Reading in data and starting up libraries\n<!--begin.rcode label=\"Read In CSV\"\nstations <- read.csv(\"Divvy_Stations_2013.csv\",header=TRUE,stringsAsFactors=FALSE)\ntrips <- read.csv(\"Divvy_Trips_2013.csv\", header=TRUE, stringsAsFactors=FALSE)\n\ntrips$starttime <- as.POSIXct(strptime(trips$starttime,format=\"%Y-%m-%d %H:%M\"))\ntrips$stoptime <- as.POSIXct(strptime(trips$stoptime,format=\"%Y-%m-%d %H:%M\"))\ntrips$\ntrips$custAgeAtStart <- trip$starttime-trip$\n\nstations$online.date <- as.POSIXct(strptime(stations$online.date,format=\"%m/%d/%Y\"))\nstations$daysOnline <- as.POSIXct(strptime(\"12-31-2013\",format=\"%m-%d-%Y\"))-stations$online.date\ntripsByDepart <- count(trips, .(from_station_id))\ntripsByDepart <- merge(tripsByDepart,stations,by.x=\"from_station_id\",by.y=\"id\",all.x=TRUE)\ntripsByDepart$norm <- tripsByDepart$freq/max(tripsByDepart$freq)\ntripsByDepart$log <- log(tripsByDepart$freq)\ntripsByDepart$normByTime <- tripsByDepart$freq/as.numeric(tripsByDepart$daysOnline)\ntripsByDepart$normByTime_norm <- tripsByDepart$normByTime/max(tripsByDepart$normByTime)\ntripsByDepart$logNormByTime <- log(tripsByDepart$log)\nend.rcode-->\n\n<!--begin.rcode fig.width=20, fig.width=8\nggplot(transform(tripsByDepart,name=reorder(name,normByTime)),aes(x=name,y=normByTime))+geom_bar(stat=\"identity\")+coord_flip()\n\nend.rcode-->\n\n\n<p>Let's map some shit... Reading in the data. To map the data provided by Divvy, we need to convert the lat long to tmerc projection matching the city gis data using the sp library</p>\n<!--begin.rcode label=\"Read in Map Layers\"\ncity <- makeLatLong(\"City_Boundary\",\"City_Boundary\")\nstationMap <- makeLatLong(\"Divvy_Stations_2013.shp\",\"Divvy_Stations_2013\")\nwards <- makeLatLong(\"Boundaries-Wards\",\"Wards\")\nbikeRt <- makeLatLong(\"Bike_Routes\",\"Bikeroutes3\")\ncops <- makeLatLong(\"Boundaries - Police Beats (current)\",\"geo_aerh-rz74-1\")\nbusinessDist <- makeLatLong(\"Boundaries_-_Central_Business_District\",\"Central_Business_District\")\nneighborhoods <- makeLatLong(\"Neighborhoods_2012\",\"Neighborhoods_2012b\")\nneighbCols <- brewer.pal(7,\"Set3\")\nneighbCols <- rep(rbind(neighbCols),14)\n##majorSt <- makeLatLong(\"Major_Streets\",\"Major_Streets\")\nend.rcode-->\n\n<p>Map Showing Bike Routes and Divvy Stations:</p>\n\n<!--begin.rcode fig.width=10, fig.height=10\nplot(city,xlim=c(-87.70786,-87.58071),ylim=c(41.78875,41.97835))\n##plot(wards,add=TRUE)\nplot(bikeRt,add=TRUE)\nplot(stationMap,add=TRUE,pch=20)\n\nend.rcode-->\n\n<p>Map showing ward and Divvy Stations:</p>\n<!--begin.rcode fig.width=10, fig.height=10\nplot(city,xlim=c(-87.70786,-87.58071),ylim=c(41.78875,41.97835))\nplot(wards,add=TRUE)\nplot(stationMap,add=TRUE,pch=20)\n\nend.rcode-->\n\n<p>Map showing police and Divvy Stations:</p>\n<!--begin.rcode fig.width=10, fig.height=10\nplot(city,xlim=c(-87.70786,-87.58071),ylim=c(41.78875,41.97835))\nplot(cops,add=TRUE)\nplot(stationMap,add=TRUE,pch=20)\nend.rcode-->\n\n<p>Map showing business district and Divvy Stations:</p>\n<!--begin.rcode fig.width=10, fig.height=10\nplot(city,xlim=c(-87.70786,-87.58071),ylim=c(41.78875,41.97835))\nplot(neighborhoods,add=TRUE,col=neighbCols)\nplot(businessDist,add=TRUE)\nplot(stationMap,add=TRUE,pch=20)\nend.rcode-->\n\n\n<p>Map showing neighborhoods, normalized pickups by Divvy Stations:</p>\n<!--begin.rcode fig.width=10, fig.height=10\nplot(city,xlim=c(-87.70786,-87.58071),ylim=c(41.78875,41.97835))\nplot(neighborhoods,add=TRUE,col=neighbCols)\npoints(tripsByDepart$longitude,tripsByDepart$latitude,pch=20,cex=(tripsByDepart$normByTime_norm)*5)\nend.rcode-->\n\n</body>\n</html>\n",
    "created" : 1393082067372.000,
    "dirty" : true,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1609655939",
    "id" : "44A5A897",
    "lastKnownWriteTime" : 1393104128,
    "path" : "~/_RWork/Divvy/_Script-DataAnalysis.Rhtml",
    "project_path" : null,
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_html"
}